---
import { bundledLanguages, getHighlighter } from "shikiji";

const { content, language } = Astro.props;

const gleam = await import("../languages/gleam.tmLanguage.json");

const mocha = (await import("../themes/mocha.json")) as any;
const latte = (await import("../themes/latte.json")) as any;

const shiki = await getHighlighter({
  langs: [...Object.keys(bundledLanguages), gleam as any],
});

const code = shiki.codeToHtml(content, {
  lang: language,
  themes: {
    light: latte,
    dark: mocha,
  },
  transforms: {
    pre(node) {
      node.properties.class += " border rounded-none";
      node.properties.class += " my-2 px-4 py-2 text-base";
    },
  },
});
---

<Fragment set:html={code} />

<style is:global>
  @media (prefers-color-scheme: dark) {
    .shiki,
    .shiki span {
      color: var(--shiki-dark) !important;
      background-color: var(--shiki-dark-bg) !important;
    }
  }
</style>
